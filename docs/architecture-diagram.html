<!DOCTYPE html>
<html>
<head>
    <title>AuditoryX Architecture Diagram</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.9.0/dist/mermaid.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 20px;
            background-color: #f8f9fa;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 30px;
        }
        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 30px;
        }
        .diagram-container {
            text-align: center;
            margin: 20px 0;
        }
        .export-info {
            background: #e8f5e8;
            border: 1px solid #d4edda;
            border-radius: 4px;
            padding: 15px;
            margin: 20px 0;
        }
        .export-info h3 {
            color: #155724;
            margin-top: 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>AuditoryX Open Network - Technical Architecture</h1>
        
        <div class="export-info">
            <h3>üì∏ Export Instructions</h3>
            <p><strong>To generate PNG:</strong> Open this file in a browser, right-click the diagram, and "Save image as" or use browser developer tools to export the SVG element.</p>
            <p><strong>Recommended size:</strong> 1440x1080 for presentations, 1920x1440 for detailed documentation</p>
        </div>

        <div class="diagram-container">
            <div class="mermaid" id="architecture-diagram">
graph TB
    %% Client Layer
    subgraph "Client Applications"
        WEB[Web App<br/>Next.js 15 + React 18]
        MOBILE[Mobile PWA<br/>Service Workers]
        API_CLIENT[API Integrations<br/>Third-party Apps]
    end

    %% Frontend Layer
    subgraph "Frontend Services"
        UI[UI Components<br/>Tailwind CSS + Framer Motion]
        STATE[State Management<br/>React Query + Context]
        AUTH_CLIENT[Auth Client<br/>NextAuth.js]
        SEARCH_UI[Search Interface<br/>Algolia InstantSearch]
    end

    %% API Gateway & Middleware
    subgraph "API Layer"
        MIDDLEWARE[Middleware<br/>Authentication & Rate Limiting]
        API_ROUTES[API Routes<br/>Next.js API Handlers]
        WEBHOOK[Webhooks<br/>Stripe Events + External APIs]
    end

    %% Core Backend Services
    subgraph "Core Services"
        AUTH_SERVICE[Authentication Service<br/>Firebase Auth + Custom Claims]
        USER_SERVICE[User Service<br/>Unified User Model]
        BOOKING_SERVICE[Booking Service<br/>Lifecycle Management]
        PAYMENT_SERVICE[Payment Service<br/>Stripe Integration]
        NOTIFICATION_SERVICE[Notification Service<br/>Multi-channel Alerts]
        SEARCH_SERVICE[Search Service<br/>Algolia Indexing]
    end

    %% Data Layer
    subgraph "Database Layer"
        FIRESTORE[(Firestore<br/>Primary Database)]
        FIREBASE_STORAGE[(Firebase Storage<br/>Media Files)]
        ALGOLIA_INDEX[(Algolia<br/>Search Index)]
        REDIS[(Redis Cache<br/>Session & Performance)]
    end

    %% External Services
    subgraph "External Integrations"
        STRIPE[Stripe<br/>Payments + Identity]
        GOOGLE_CAL[Google Calendar<br/>Scheduling Integration]
        SENDGRID[SendGrid<br/>Email Delivery]
        TWILIO[Twilio<br/>SMS Notifications]
        SENTRY[Sentry<br/>Error Monitoring]
    end

    %% Cloud Functions
    subgraph "Serverless Functions"
        CRON_FUNCTIONS[Scheduled Functions<br/>Cleanup + Analytics]
        TRIGGER_FUNCTIONS[Database Triggers<br/>Real-time Updates]
        HTTP_FUNCTIONS[HTTP Functions<br/>Webhooks + Processing]
    end

    %% Security & Monitoring
    subgraph "Security & Monitoring"
        FIRESTORE_RULES[Firestore Security Rules<br/>Row-Level Security]
        ENCRYPTION[End-to-End Encryption<br/>Chat + Sensitive Data]
        MONITORING[Performance Monitoring<br/>Analytics + Logging]
    end

    %% Data Flow Connections
    WEB --> UI
    MOBILE --> UI
    API_CLIENT --> API_ROUTES
    
    UI --> STATE
    STATE --> AUTH_CLIENT
    UI --> SEARCH_UI
    
    AUTH_CLIENT --> MIDDLEWARE
    SEARCH_UI --> API_ROUTES
    MIDDLEWARE --> API_ROUTES
    
    API_ROUTES --> AUTH_SERVICE
    API_ROUTES --> USER_SERVICE
    API_ROUTES --> BOOKING_SERVICE
    API_ROUTES --> PAYMENT_SERVICE
    API_ROUTES --> NOTIFICATION_SERVICE
    API_ROUTES --> SEARCH_SERVICE
    
    AUTH_SERVICE --> FIRESTORE
    USER_SERVICE --> FIRESTORE
    BOOKING_SERVICE --> FIRESTORE
    PAYMENT_SERVICE --> STRIPE
    SEARCH_SERVICE --> ALGOLIA_INDEX
    NOTIFICATION_SERVICE --> SENDGRID
    NOTIFICATION_SERVICE --> TWILIO
    
    WEBHOOK --> STRIPE
    WEBHOOK --> GOOGLE_CAL
    
    FIRESTORE --> TRIGGER_FUNCTIONS
    CRON_FUNCTIONS --> FIRESTORE
    HTTP_FUNCTIONS --> EXTERNAL_APIS[External APIs]
    
    USER_SERVICE --> FIREBASE_STORAGE
    SEARCH_SERVICE --> FIRESTORE
    
    FIRESTORE_RULES --> FIRESTORE
    ENCRYPTION --> FIRESTORE
    MONITORING --> SENTRY
    
    %% Performance Optimizations
    STATE -.-> REDIS
    SEARCH_SERVICE -.-> REDIS
    
    %% Styling
    classDef clientLayer fill:#e1f5fe
    classDef frontendLayer fill:#f3e5f5
    classDef apiLayer fill:#fff3e0
    classDef serviceLayer fill:#e8f5e8
    classDef dataLayer fill:#fff8e1
    classDef externalLayer fill:#fce4ec
    classDef serverlessLayer fill:#f1f8e9
    classDef securityLayer fill:#ffebee
    
    class WEB,MOBILE,API_CLIENT clientLayer
    class UI,STATE,AUTH_CLIENT,SEARCH_UI frontendLayer
    class MIDDLEWARE,API_ROUTES,WEBHOOK apiLayer
    class AUTH_SERVICE,USER_SERVICE,BOOKING_SERVICE,PAYMENT_SERVICE,NOTIFICATION_SERVICE,SEARCH_SERVICE serviceLayer
    class FIRESTORE,FIREBASE_STORAGE,ALGOLIA_INDEX,REDIS dataLayer
    class STRIPE,GOOGLE_CAL,SENDGRID,TWILIO,SENTRY externalLayer
    class CRON_FUNCTIONS,TRIGGER_FUNCTIONS,HTTP_FUNCTIONS serverlessLayer
    class FIRESTORE_RULES,ENCRYPTION,MONITORING securityLayer
            </div>
        </div>

        <div class="export-info">
            <h3>üèóÔ∏è Architecture Overview</h3>
            <p><strong>Client Layer:</strong> Web app, mobile PWA, and API integrations for third-party access</p>
            <p><strong>Frontend Services:</strong> React-based UI with state management and authentication</p>
            <p><strong>API Layer:</strong> Next.js API routes with middleware for security and rate limiting</p>
            <p><strong>Core Services:</strong> Business logic services for user management, booking, payments</p>
            <p><strong>Data Layer:</strong> Firebase Firestore primary database with caching and search indexing</p>
            <p><strong>External Integrations:</strong> Stripe payments, calendar sync, notifications, monitoring</p>
            <p><strong>Security:</strong> Multi-layer security with encryption, RLS, and compliance controls</p>
        </div>
    </div>

    <script>
        mermaid.initialize({ 
            startOnLoad: true,
            theme: 'default',
            flowchart: {
                useMaxWidth: true,
                htmlLabels: true,
                curve: 'basis'
            }
        });
    </script>
</body>
</html>